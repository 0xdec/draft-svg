{"version":3,"sources":["draft-svg.js"],"names":["NS","VERSION","mixin","renderSVG","width","height","create","element","type","svg","document","createElementNS","calcX","draft","px","prop","calcY","svgRoot","this","setAttribute","domID","undefined","join","recursive","obj","func","key","Array","isArray","Doc","View","Element","console","info","listener","parent","appendChild","val","target","apply","radius","on","Page"],"mappings":"AAAA,cAUA,WACE,GAAMA,GAAK,6BAGLC,EAAU,MAEZC,GAEFC,UAAS,SAACC,EAAOC,GACf,GAAIC,GAAS,SAASC,EAASC,GAC7B,GAAIC,GAAMC,SAASC,gBAAgBX,EAAIQ,EAEvC,OADAD,GAAQE,IAAMA,EACPA,GAGLG,EAAQ,SAASL,GACnB,MAAOM,OAAMC,GAAGP,EAAQQ,KAAK,MAAQF,MAAMC,GAAGP,EAAQH,SAAW,GAG/DY,EAAQ,SAAST,GACnB,OAAQM,MAAMC,GAAGP,EAAQQ,KAAK,MAAQF,MAAMC,GAAGP,EAAQF,UAAY,GAGjEY,EAAUX,EAAOY,KAAM,MAC3BD,GAAQE,aAAa,QAASnB,GAC9BiB,EAAQE,aAAa,UAAWlB,GAASgB,EAGjCE,aAAa,KAAMD,KAAKE,OAChCH,EAAQE,aAAa,QAASf,GACfiB,SAAXhB,GACFY,EAAQE,aAAa,SAAUd,GAChCY,EAGOE,aAAa,WACnBP,EAAMM,MAAOF,EAAME,MACnBL,MAAMC,GAAGI,KAAKd,SAAUS,MAAMC,GAAGI,KAAKb,WACtCiB,KAAK,KAAM,IAGTC,GAAY,QAAZA,GAAqBC,EAAKC,GAC5B,IAAK,GAAIC,KAAOF,GACdD,EAAUI,MAAMC,QAAQJ,EAAIE,IAC1BF,EAAIE,GAAOD,EAAKD,EAAKE,GAAMD,GAmEjC,OA/DAF,GAAUL,KAAM,SAASM,EAAKE,GAC5B,GAAY,WAARA,GACFF,EAAIE,YAAgBb,OAAMgB,KAC1BL,EAAIE,YAAgBb,OAAMiB,KAC1B,OAAO,CACF,IAAIN,EAAIE,YAAgBb,OAAMkB,QAAS,CAC5CC,QAAQC,KAAK,iBAAkBT,EAAIE,GAAKX,OAExC,IACImB,GADA1B,EAAOgB,EAAIE,GAAKlB,KAIhBC,EAAMH,EAAOkB,EAAIE,GAAMlB,EA+C3B,OA9CAgB,GAAIE,GAAKS,OAAO1B,IAAI2B,YAAY3B,GAChCA,EAAIU,aAAa,eAAgB,GACjCV,EAAIU,aAAa,SAAU,QAGd,SAATX,GACF0B,EAAW,SAASnB,EAAMsB,GACxBA,EAAMxB,MAAMC,GAAGuB,GAEF,UAATtB,EACFN,EAAIU,aAAa,QAASN,MAAMC,GAAGuB,IACjB,WAATtB,GACTN,EAAIU,aAAa,SAAUN,MAAMC,GAAGuB,IAGzB,MAATtB,GAAyB,UAATA,EAClBN,EAAIU,aAAa,IAAKP,EAAMM,KAAKoB,UACf,MAATvB,GAAyB,WAATA,IACzBN,EAAIU,aAAa,IAAKH,EAAME,KAAKoB,UAKrCJ,EAASK,OAAOD,OAAQd,EAAIE,KAAQ,QAASF,EAAIE,GAAKtB,UACtD8B,EAASK,OAAOD,OAAQd,EAAIE,KAAQ,SAAUF,EAAIE,GAAKrB,WACvD6B,EAASK,OAAOD,OAAQd,EAAIE,KAAQ,IAAKF,EAAIE,GAAKX,KAAK,OACvDmB,EAASK,OAAOD,OAAQd,EAAIE,KAAQ,IAAKF,EAAIE,GAAKX,KAAK,QAErC,WAATP,IACT0B,EAAW,SAASnB,EAAMsB,GACxBA,EAAMxB,MAAMC,GAAGuB,GAEF,MAATtB,EACFN,EAAIU,aAAa,IAAKkB,GACJ,MAATtB,EACTN,EAAIU,aAAa,KAAMN,MAAMC,GAAGuB,IACd,MAATtB,GACTN,EAAIU,aAAa,MAAON,MAAMC,GAAGuB,MAI5B,IAAKb,EAAIE,GAAKc,UAGzBhB,EAAIE,GAAKe,GAAG,SAAUP,GAEfV,EAAIE,MAIRT,GAIXJ,OAAM6B,KAAKxC,MAAMA,GACjBW,MAAMiB,KAAK5B,MAAMA","file":"draft-svg.min.js","sourcesContent":["/*\n* draft-svg - A plugin for draft.js that renders drafts using SVG\n* version v0.0.0\n* https://github.com/D1SC0tech/draft-svg\n*\n* copyright Jordi Pakey-Rodriguez <jordi.orlando@gmail.com>\n* license MIT\n*\n* BUILT: Mon Jan 18 2016 00:00:58 GMT-0600 (CST)\n*/\n(function() {\n  const NS = 'http://www.w3.org/2000/svg';\n  // const XMLNS = 'http://www.w3.org/2000/xmlns/';\n  // const XLINK = 'http://www.w3.org/1999/xlink';\n  const VERSION = '1.1';\n\n  var mixin = {\n    // TODO: add elements to SVG dom as they are created in js\n    renderSVG(width, height) {\n      var create = function(element, type) {\n        var svg = document.createElementNS(NS, type);\n        element.svg = svg;\n        return svg;\n      };\n\n      var calcX = function(element) {\n        return draft.px(element.prop('x')) - draft.px(element.width()) / 2;\n      };\n\n      var calcY = function(element) {\n        return -draft.px(element.prop('y')) - draft.px(element.height()) / 2;\n      };\n\n      var svgRoot = create(this, 'svg');\n      svgRoot.setAttribute('xmlns', NS);\n      svgRoot.setAttribute('version', VERSION);\n      // svgRoot.setAttributeNS(XMLNS, 'xmlns:xlink', XLINK);\n\n      svgRoot.setAttribute('id', this.domID);\n      svgRoot.setAttribute('width', width);\n      if (height !== undefined) {\n        svgRoot.setAttribute('height', height);\n      }\n\n      // 1 SVG user unit = 1px\n      svgRoot.setAttribute('viewBox', [\n        calcX(this), calcY(this),\n        draft.px(this.width()), draft.px(this.height())\n      ].join(' '));\n\n      // TODO: move this to draft.js\n      var recursive = function(obj, func) {\n        for (let key in obj) {\n          recursive(Array.isArray(obj[key]) ?\n            obj[key] : func(obj, key), func);\n        }\n      };\n\n      recursive(this, function(obj, key) {\n        if (key === 'parent' ||\n          obj[key] instanceof draft.Doc ||\n          obj[key] instanceof draft.View) {\n          return false;\n        } else if (obj[key] instanceof draft.Element) {\n          console.info('rendering svg:', obj[key].prop());\n\n          var type = obj[key].type;\n          var listener;\n\n          // TODO: modularize svg creation\n          var svg = create(obj[key], type);\n          obj[key].parent.svg.appendChild(svg);\n          svg.setAttribute('fill-opacity', 0);\n          svg.setAttribute('stroke', '#000');\n\n          // TODO: separate listener for each property?\n          if (type === 'rect') {\n            listener = function(prop, val) {\n              val = draft.px(val);\n\n              if (prop === 'width') {\n                svg.setAttribute('width', draft.px(val));\n              } else if (prop === 'height') {\n                svg.setAttribute('height', draft.px(val));\n              }\n\n              if (prop === 'x' || prop === 'width') {\n                svg.setAttribute('x', calcX(this.target));\n              } else if (prop === 'y' || prop === 'height') {\n                svg.setAttribute('y', calcY(this.target));\n              }\n              // svg.setAttribute('x', );\n            };\n\n            listener.apply({target: obj[key]}, ['width', obj[key].width()]);\n            listener.apply({target: obj[key]}, ['height', obj[key].height()]);\n            listener.apply({target: obj[key]}, ['x', obj[key].prop('x')]);\n            listener.apply({target: obj[key]}, ['y', obj[key].prop('y')]);\n            // svg.setAttribute('x', );\n          } else if (type === 'circle') {\n            listener = function(prop, val) {\n              val = draft.px(val);\n\n              if (prop === 'r') {\n                svg.setAttribute('r', val);\n              } else if (prop === 'x') {\n                svg.setAttribute('cx', draft.px(val));\n              } else if (prop === 'y') {\n                svg.setAttribute('cy', -draft.px(val));\n              }\n            };\n\n            listener('r', obj[key].radius());\n          }\n\n          obj[key].on('change', listener);\n\n          return obj[key];\n        }\n      });\n\n      return svgRoot;\n    }\n  };\n\n  draft.Page.mixin(mixin);\n  draft.View.mixin(mixin);\n})();\n"],"sourceRoot":"/source/"}