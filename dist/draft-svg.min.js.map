{"version":3,"sources":["draft-svg.min.js","draft-svg.js"],"names":["draft","View","mixin","svg","width","height","_this","this","_svgMaxWidth","_svgMaxHeight","undefined","_svg","calcX","calcY","domPrefix","domID","find","_render","listener","NS","VERSION","element","px","prop","doc","document","getElementByID","console","info","node","createElementNS","type","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","children","Symbol","iterator","next","done","child","value","childNode","appendChild","err","on","removeChild","val","setAttribute","target","id","apply","join","zoom","Math","min","svgWidth","svgHeight","parent"],"mappings":"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","file":"draft-svg.min.js","sourcesContent":[null,"/*\n* draft-svg - A plugin for draft.js that renders models using SVG\n* version v0.0.2\n* http://draft.D1SC0te.ch\n*\n* copyright Jordi Pakey-Rodriguez <jordi.orlando@hexa.io>\n* license MIT\n*\n* BUILT: Fri Jan 22 2016 03:21:17 GMT-0600 (CST)\n*/\n'use strict';\n\n(function () {\n  draft.View.mixin({\n    svg: function svg(width, height) {\n      var _this = this;\n\n      this._svgMaxWidth = width || this._svgMaxWidth || this.width();\n      this._svgMaxHeight = height || this._svgMaxHeight || this.height();\n\n      if (this._svg === undefined) {\n        var calcX;\n        var calcY;\n        var domPrefix;\n        var domID;\n        var find;\n\n        var _render;\n\n        var svg;\n        var listener;\n\n        (function () {\n          var NS = 'http://www.w3.org/2000/svg';\n          // const XMLNS = 'http://www.w3.org/2000/xmlns/';\n          // const XLINK = 'http://www.w3.org/1999/xlink';\n          var VERSION = '1.1';\n\n          calcX = function calcX(element) {\n            return draft.px(element.prop('x')) - element.width() / 2;\n          };\n\n          calcY = function calcY(element) {\n            return -draft.px(element.prop('y')) - element.height() / 2;\n          };\n\n          domPrefix = _this.doc.domID + ':' + _this.domID + ':svg';\n\n          domID = function domID(element) {\n            return domPrefix + ':' + element.domID;\n          };\n\n          find = function find(element) {\n            return document.getElementByID(domID(element));\n          };\n\n          _render = function render(element) {\n            console.info('rendering svg:', element.domID);\n\n            var node = document.createElementNS(NS, element.type);\n\n            // TODO: separate listener for each property?\n            var listener;\n\n            switch (element.type) {\n              case 'group':\n                node = document.createElementNS(NS, 'g');\n\n                var _iteratorNormalCompletion = true;\n                var _didIteratorError = false;\n                var _iteratorError = undefined;\n\n                try {\n                  for (var _iterator = element.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var child = _step.value;\n\n                    var childNode = _render(child);\n                    if (childNode) {\n                      node.appendChild(childNode);\n                    }\n                  }\n                } catch (err) {\n                  _didIteratorError = true;\n                  _iteratorError = err;\n                } finally {\n                  try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                      _iterator.return();\n                    }\n                  } finally {\n                    if (_didIteratorError) {\n                      throw _iteratorError;\n                    }\n                  }\n                }\n\n                element.on('add', function (child) {\n                  var childNode = _render(child);\n                  if (childNode) {\n                    node.appendChild(childNode);\n                  }\n                });\n\n                element.on('remove', function (child) {\n                  node.removeChild(find(child));\n                });\n              // Falls through\n              case 'rect':\n                listener = function listener(prop, val) {\n                  val = draft.px(val);\n\n                  switch (prop) {\n                    case 'width':\n                      node.setAttribute('width', val);\n                    // Falls through\n                    case 'x':\n                      node.setAttribute('x', calcX(this.target));\n                      break;\n                    case 'height':\n                      node.setAttribute('height', val);\n                    // Falls through\n                    case 'y':\n                      node.setAttribute('y', calcY(this.target));\n                      break;\n                  }\n                };\n\n                break;\n              case 'circle':\n                listener = function listener(prop, val) {\n                  val = draft.px(val);\n\n                  /* if (prop === 'cy') {\n                    val *= -1;\n                  }\n                   node.setAttribute(prop, val); */\n\n                  switch (prop) {\n                    case 'r':\n                      node.setAttribute('r', val);\n                      break;\n                    case 'x':\n                      node.setAttribute('cx', val);\n                      break;\n                    case 'y':\n                      node.setAttribute('cy', -val);\n                      break;\n                  }\n                };\n\n                break;\n            }\n\n            // TODO: support all elements\n            if (typeof listener === 'function') {\n              node.id = domID(element);\n\n              // TODO: add support for fill and stroke\n              node.setAttribute('fill-opacity', 0);\n              node.setAttribute('stroke', '#000');\n              node.setAttribute('stroke-width', 1);\n\n              for (var prop in element.prop()) {\n                listener.apply({ target: element }, [prop, element.prop(prop)]);\n              }\n\n              element.on('change', listener);\n\n              return node;\n            }\n          };\n\n          svg = _this._svg = document.createElementNS(NS, 'svg');\n\n          svg.setAttribute('xmlns', NS);\n          svg.setAttribute('version', VERSION);\n          // svg.setAttributeNS(XMLNS, 'xmlns:xlink', XLINK);\n\n          svg.id = domID(_this);\n\n          listener = function listener(prop) {\n            if (prop === 'width' || prop === 'height') {\n              // 1 SVG user unit = 1px\n              svg.setAttribute('viewBox', [calcX(this.target), calcY(this.target), this.target.width(), this.target.height()].join(' '));\n\n              var zoom = Math.min(draft.px(this.target._svgMaxWidth) / this.target.width(), draft.px(this.target._svgMaxHeight) / this.target.height());\n\n              var svgWidth = this.target.width() * zoom;\n              var svgHeight = this.target.height() * zoom;\n\n              this.target._svg.setAttribute('width', svgWidth);\n              this.target._svg.setAttribute('height', svgHeight);\n\n              // console.info('aspect ratio:', this.target.aspectRatio);\n            }\n          };\n\n          listener.apply({ target: _this }, ['width']);\n          listener.apply({ target: _this }, ['height']);\n\n          _this.on('change', listener);\n\n          svg.appendChild(_render(_this.parent));\n        })();\n      }\n\n      return this._svg;\n    }\n  });\n})();"],"sourceRoot":"/source/"}